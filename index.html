<script>
  async function loadData() {
    try {
      // 1. Allgemeine Infos
      const resStats = await fetch("https://backend.bigtimefm.de/includes/data/fetch_stats.php?radioinfos");
      const textStats = await resStats.text();
      const stats = JSON.parse(textStats); // Falls es doch JSON ist

      document.getElementById("dj").textContent = stats.dj || "Unbekannt";
      document.getElementById("thema").textContent = stats.sendung || "–";
      document.getElementById("zuhoerer").textContent = stats.listener + " Zuhörer";
      document.getElementById("titel").textContent = stats.song || "–";
      document.getElementById("rekord").textContent = stats.listener_max + " Zuhörer";
      document.getElementById("bitrate").textContent = stats.bitrate + " kbps";
    } catch (err) {
      console.error("Fehler beim Laden von radioinfos:", err);
    }

    try {
      // 2. DJ-Status
      const resStatus = await fetch("https://backend.bigtimefm.de/includes/data/fetch_stats.php?djstatus");
      const textStatus = await resStatus.text();
      const status = JSON.parse(textStatus);

      document.getElementById("datetime").textContent = status.zeit || "Unbekannt";
      document.getElementById("grussbox").innerHTML = status.grussbox === "aktiv"
        ? "<span class='highlight'>aktiv</span>"
        : "<span class='deactivated'>deaktiviert</span>";
      document.getElementById("wunsch").innerHTML = status.wunschbox === "aktiv"
        ? "<span class='highlight'>aktiv</span>"
        : "<span class='gray'>deaktiviert</span>";
      document.getElementById("voicemail").innerHTML = status.voicemail === "aktiv"
        ? "<span class='highlight'>aktiv</span>"
        : "<span class='gray'>deaktiviert</span>";
      document.getElementById("umfragen").innerHTML = status.umfrage === "aktiv"
        ? "<span class='highlight'>aktiv</span>"
        : "<span class='gray'>deaktiviert</span>";
    } catch (err) {
      console.error("Fehler beim Laden von djstatus:", err);
    }

    try {
      // 3. Sendeplan
      const resPlan = await fetch("https://backend.bigtimefm.de/includes/data/fetch_stats.php?sendeplan");
      const textPlan = await resPlan.text();
      const plan = JSON.parse(textPlan);

      const sendeplanDiv = document.getElementById("sendeplan");
      sendeplanDiv.innerHTML = "";
      plan.forEach(block => {
        const p = document.createElement("p");
        p.innerHTML = `<strong>${block.von} - ${block.bis} Uhr</strong><br>${block.dj}<br><span class="gray">${block.sendung}</span>`;
        sendeplanDiv.appendChild(p);
      });
    } catch (err) {
      console.error("Fehler beim Laden vom Sendeplan:", err);
    }
  }

  loadData();
  setInterval(loadData, 30 * 1000);
</script>
